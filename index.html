<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Teste</title>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 10px;
            padding: 10px;

        }
        #canvas {
            height: 100%;
            background-color: #eee;
        }
    </style>
</head>
<body>
    <img hidden src="needle.png" id="needle-img"/>
    <div>
        <div><b id="result">set number of needles in the next input</b></div>
        <input type="text" id="n_sample" value="1">
        <button id="btn-go">Go</button>
        <b id="pos"></b>
    </div>
    <canvas id="canvas"></canvas>
    <script
            src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
    <script>
        const height = $("#canvas").height();
        const width = $("#canvas").height();
        const used_width = height - height % 200;
        const NEEDLE_HEIGHT = 100;
        const NEEDLE_WIDTH = 3;
        const needle_img = document.getElementById("needle-img");

        var c = document.getElementById("canvas");
        c.height = height;
        c.width = used_width;

        function degrees(radians) {
            return radians * (180/Math.PI);
        }

        function radians(degrees) {
            return degrees * (Math.PI/180);
        }

        function generate_result(ctx) {
            const x = Math.floor( Math.random() * used_width );
            const y = Math.floor( Math.random() * height );
            const angle = Math.floor( Math.random() * 180) - 90;

            const needle_left_y  = y - Math.sin(radians(angle)) * NEEDLE_HEIGHT/2;
            const needle_right_y = y + Math.sin(radians(angle)) * NEEDLE_HEIGHT/2;

            const needle_left_x  = x - Math.cos(radians(angle)) * NEEDLE_HEIGHT/2;
            const needle_right_x = x + Math.cos(radians(angle)) * NEEDLE_HEIGHT/2;

            //console.log(angle, Math.cos(radians(angle)), radians(angle), needle_left_x, x, needle_right_x);

            //ctx.beginPath();
            ctx.save();
            ctx.translate(x,y);
            ctx.rotate(radians(angle-90));
            ctx.translate(-NEEDLE_WIDTH/2,-NEEDLE_HEIGHT/2);
            ctx.drawImage(needle_img, 0,0, NEEDLE_WIDTH, NEEDLE_HEIGHT);
            ctx.restore();


            let i;
            for (i = 0; i <= used_width; i += 2*NEEDLE_HEIGHT) {
                const line_x = i;
                if (line_x > needle_left_x &&
                    line_x < needle_right_x ) {
                    return 1;
                }
            }
            return 0;
        }

        function generate_sample_result(n_sample) {
            var ctx = c.getContext("2d");
            ctx.clearRect(0,0,width,height);
            ctx.beginPath();
            ctx.save();
            ctx.lineWidth = 4;

            ctx.strokeStyle = "#000000";
            let i;
            for (i = 0; i <= used_width; i+=2*NEEDLE_HEIGHT) {
                ctx.moveTo(i, 0);
                ctx.lineTo(i, height);
                ctx.stroke();
            }

            let count_crosseds = 0;
            for (i = 0; i < n_sample; i++) {
                count_crosseds += generate_result(ctx);
            }
            $("#result").text(i / count_crosseds);
        }

        $("#btn-go").click( function () {
            let n_sample = parseInt($("#n_sample").val());
            generate_sample_result(n_sample);
        })
    </script>
</body>
</html>